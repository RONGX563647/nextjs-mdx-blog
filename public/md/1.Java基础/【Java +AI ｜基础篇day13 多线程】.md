# 13ğŸ§µ Java Day13 - å¤šçº¿ç¨‹

> ğŸ’¡ **æ ¸å¿ƒæç¤º**ï¼šå¤šçº¿ç¨‹æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ï¼Œæœ¬æ–‡ç³»ç»Ÿè®²è§£çº¿ç¨‹åˆ›å»ºã€çº¿ç¨‹åŒæ­¥ã€çº¿ç¨‹æ± ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œå¸®ä½ æŒæ¡ Java å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚

---

## å¿«é€Ÿå›é¡¾

- **çº¿ç¨‹**ï¼šç¨‹åºæ‰§è¡Œçš„æœ€å°å•å…ƒï¼Œè¿›ç¨‹ä¸­çš„å•ä¸ªæ‰§è¡Œæµ
- **çº¿ç¨‹åˆ›å»º**ï¼šç»§æ‰¿ Threadã€å®ç° Runnableã€å®ç° Callable
- **çº¿ç¨‹åŒæ­¥**ï¼šsynchronizedã€Lockã€åŸå­ç±»ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜
- **çº¿ç¨‹æ± **ï¼šç®¡ç†å’Œå¤ç”¨çº¿ç¨‹ï¼Œæé«˜æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡

---

## ç›®å½•

- [ä¸€ã€çº¿ç¨‹åŸºç¡€](#ä¸€çº¿ç¨‹åŸºç¡€)
  - [1. çº¿ç¨‹ä¸è¿›ç¨‹](#1-çº¿ç¨‹ä¸è¿›ç¨‹)
  - [2. çº¿ç¨‹åˆ›å»ºæ–¹å¼](#2-çº¿ç¨‹åˆ›å»ºæ–¹å¼)
  - [3. çº¿ç¨‹å¸¸ç”¨æ–¹æ³•](#3-çº¿ç¨‹å¸¸ç”¨æ–¹æ³•)
- [äºŒã€çº¿ç¨‹åŒæ­¥](#äºŒçº¿ç¨‹åŒæ­¥)
  - [1. çº¿ç¨‹å®‰å…¨é—®é¢˜](#1-çº¿ç¨‹å®‰å…¨é—®é¢˜)
  - [2. synchronized å…³é”®å­—](#2-synchronized-å…³é”®å­—)
  - [3. Lock æ¥å£](#3-lock-æ¥å£)
  - [4. åŸå­ç±»](#4-åŸå­ç±»)
- [ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡](#ä¸‰çº¿ç¨‹é—´é€šä¿¡)
- [å››ã€çº¿ç¨‹æ± ](#å››çº¿ç¨‹æ± )
  - [1. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ](#1-ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± )
  - [2. åˆ›å»ºçº¿ç¨‹æ± ](#2-åˆ›å»ºçº¿ç¨‹æ± )
  - [3. çº¿ç¨‹æ± å‚æ•°è¯¦è§£](#3-çº¿ç¨‹æ± å‚æ•°è¯¦è§£)
  - [4. çº¿ç¨‹æ± ä½¿ç”¨](#4-çº¿ç¨‹æ± ä½¿ç”¨)
- [äº”ã€çº¿ç¨‹çŠ¶æ€](#äº”çº¿ç¨‹çŠ¶æ€)
- [é—®ç­”](#é—®ç­”)

---

## è¯¦ç»†å†…å®¹

### ä¸€ã€çº¿ç¨‹åŸºç¡€

#### 1. çº¿ç¨‹ä¸è¿›ç¨‹

| ç‰¹æ€§ | è¿›ç¨‹ | çº¿ç¨‹ |
|------|------|------|
| å®šä¹‰ | ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ | è¿›ç¨‹ä¸­çš„æ‰§è¡Œå•å…ƒ |
| èµ„æº | ç‹¬ç«‹åœ°å€ç©ºé—´ | å…±äº«è¿›ç¨‹èµ„æº |
| å¼€é”€ | å¤§ï¼ˆåˆ›å»º/åˆ‡æ¢ï¼‰ | å° |
| é€šä¿¡ | å¤æ‚ï¼ˆIPCï¼‰ | ç®€å•ï¼ˆå…±äº«å†…å­˜ï¼‰ |
| å´©æºƒå½±å“ | ä¸å½±å“å…¶ä»–è¿›ç¨‹ | å¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒ |

#### 2. çº¿ç¨‹åˆ›å»ºæ–¹å¼

**æ–¹å¼1ï¼šç»§æ‰¿ Thread ç±»**

```java
public class MyThread extends Thread {
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println(Thread.currentThread().getName() + ": " + i);
        }
    }
}

// ä½¿ç”¨
MyThread t1 = new MyThread();
t1.setName("çº¿ç¨‹1");
t1.start();  // å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨ run() æ–¹æ³•
```

**æ–¹å¼2ï¼šå®ç° Runnable æ¥å£ï¼ˆæ¨èï¼‰**

```java
public class MyRunnable implements Runnable {
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println(Thread.currentThread().getName() + ": " + i);
        }
    }
}

// ä½¿ç”¨
MyRunnable runnable = new MyRunnable();
Thread t2 = new Thread(runnable, "çº¿ç¨‹2");
t2.start();

// Lambda ç®€åŒ–
new Thread(() -> {
    System.out.println("æ–°çº¿ç¨‹æ‰§è¡Œ");
}, "çº¿ç¨‹3").start();
```

**æ–¹å¼3ï¼šå®ç° Callable æ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼‰**

```java
public class MyCallable implements Callable<String> {
    @Override
    public String call() throws Exception {
        Thread.sleep(1000);
        return "ä»»åŠ¡å®Œæˆ";
    }
}

// ä½¿ç”¨
FutureTask<String> futureTask = new FutureTask<>(new MyCallable());
new Thread(futureTask).start();
String result = futureTask.get();  // é˜»å¡ç­‰å¾…ç»“æœ
System.out.println(result);
```

#### 3. çº¿ç¨‹å¸¸ç”¨æ–¹æ³•

```java
Thread t = new Thread();

// å¯åŠ¨çº¿ç¨‹
t.start();

// çº¿ç¨‹ä¼‘çœ ï¼ˆä¸ä¼šé‡Šæ”¾é”ï¼‰
Thread.sleep(1000);

// çº¿ç¨‹è®©æ­¥ï¼ˆè®©å‡º CPUï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ï¼‰
Thread.yield();

// ç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
t.join();

// è®¾ç½®å®ˆæŠ¤çº¿ç¨‹
t.setDaemon(true);

// è·å–çº¿ç¨‹ä¿¡æ¯
String name = t.getName();
int priority = t.getPriority();  // 1-10ï¼Œé»˜è®¤5
Thread.State state = t.getState();
boolean isAlive = t.isAlive();
boolean isDaemon = t.isDaemon();

// ä¸­æ–­çº¿ç¨‹
t.interrupt();
boolean isInterrupted = t.isInterrupted();
```

---

### äºŒã€çº¿ç¨‹åŒæ­¥

#### 1. çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
public class TicketSystem {
    private int tickets = 100;
    
    // çº¿ç¨‹ä¸å®‰å…¨
    public void sellTicket() {
        if (tickets > 0) {
            System.out.println(Thread.currentThread().getName() + 
                "å–å‡ºç¬¬" + tickets + "å¼ ç¥¨");
            tickets--;
        }
    }
}
```

**é—®é¢˜**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ¤æ–­ `tickets > 0`ï¼Œå¯èƒ½å¯¼è‡´è¶…å–ã€‚

#### 2. synchronized å…³é”®å­—

**åŒæ­¥ä»£ç å—**ï¼š
```java
public class TicketSystem {
    private int tickets = 100;
    private final Object lock = new Object();
    
    public void sellTicket() {
        synchronized (lock) {  // åŒæ­¥ä»£ç å—
            if (tickets > 0) {
                System.out.println(Thread.currentThread().getName() + 
                    "å–å‡ºç¬¬" + tickets + "å¼ ç¥¨");
                tickets--;
            }
        }
    }
}
```

**åŒæ­¥æ–¹æ³•**ï¼š
```java
public class TicketSystem {
    private int tickets = 100;
    
    public synchronized void sellTicket() {  // åŒæ­¥æ–¹æ³•
        if (tickets > 0) {
            System.out.println(Thread.currentThread().getName() + 
                "å–å‡ºç¬¬" + tickets + "å¼ ç¥¨");
            tickets--;
        }
    }
}
```

**é™æ€åŒæ­¥æ–¹æ³•**ï¼š
```java
public class TicketSystem {
    private static int tickets = 100;
    
    public static synchronized void sellTicket() {  // ç±»é”
        if (tickets > 0) {
            tickets--;
        }
    }
}
```

#### 3. Lock æ¥å£

```java
import java.util.concurrent.locks.ReentrantLock;

public class TicketSystem {
    private int tickets = 100;
    private final ReentrantLock lock = new ReentrantLock();
    
    public void sellTicket() {
        lock.lock();  // è·å–é”
        try {
            if (tickets > 0) {
                System.out.println(Thread.currentThread().getName() + 
                    "å–å‡ºç¬¬" + tickets + "å¼ ç¥¨");
                tickets--;
            }
        } finally {
            lock.unlock();  // é‡Šæ”¾é”ï¼ˆå¿…é¡»åœ¨ finally ä¸­ï¼‰
        }
    }
}
```

**synchronized vs Lock**ï¼š

| ç‰¹æ€§ | synchronized | Lock |
|------|--------------|------|
| å®ç°æ–¹å¼ | JVM å±‚é¢ | API å±‚é¢ |
| é‡Šæ”¾é” | è‡ªåŠ¨é‡Šæ”¾ | æ‰‹åŠ¨é‡Šæ”¾ï¼ˆfinallyï¼‰ |
| å¯ä¸­æ–­ | ä¸æ”¯æŒ | æ”¯æŒ `lockInterruptibly()` |
| è¶…æ—¶è·å– | ä¸æ”¯æŒ | æ”¯æŒ `tryLock(timeout)` |
| æ¡ä»¶å˜é‡ | ä¸€ä¸ªï¼ˆwait/notifyï¼‰ | å¤šä¸ªï¼ˆConditionï¼‰ |
| å…¬å¹³é” | éå…¬å¹³ | å¯é…ç½®å…¬å¹³/éå…¬å¹³ |

#### 4. åŸå­ç±»

```java
import java.util.concurrent.atomic.AtomicInteger;

public class Counter {
    private AtomicInteger count = new AtomicInteger(0);
    
    public void increment() {
        count.incrementAndGet();  // åŸå­è‡ªå¢
    }
    
    public int getCount() {
        return count.get();
    }
}
```

**å¸¸ç”¨åŸå­ç±»**ï¼š
- `AtomicInteger`ã€`AtomicLong`ã€`AtomicBoolean`
- `AtomicIntegerArray`ã€`AtomicLongArray`
- `AtomicReference`

---

### ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡

```java
public class ProducerConsumer {
    private boolean flag = false;
    private String data;
    
    // ç”Ÿäº§è€…
    public synchronized void produce(String value) {
        while (flag) {
            try {
                wait();  // ç­‰å¾…æ¶ˆè´¹
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        data = value;
        flag = true;
        notifyAll();  // é€šçŸ¥æ¶ˆè´¹è€…
    }
    
    // æ¶ˆè´¹è€…
    public synchronized String consume() {
        while (!flag) {
            try {
                wait();  // ç­‰å¾…ç”Ÿäº§
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        flag = false;
        notifyAll();  // é€šçŸ¥ç”Ÿäº§è€…
        return data;
    }
}
```

**å…³é”®æ–¹æ³•**ï¼š
- `wait()`ï¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€
- `notify()`ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹
- `notifyAll()`ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹

---

### å››ã€çº¿ç¨‹æ± 

#### 1. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± 

- **é™ä½èµ„æºæ¶ˆè€—**ï¼šå¤ç”¨çº¿ç¨‹ï¼Œå‡å°‘åˆ›å»º/é”€æ¯å¼€é”€
- **æé«˜å“åº”é€Ÿåº¦**ï¼šä»»åŠ¡åˆ°è¾¾æ—¶æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»º
- **ä¾¿äºç®¡ç†**ï¼šæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°ï¼Œä¾¿äºç›‘æ§

#### 2. åˆ›å»ºçº¿ç¨‹æ± 

```java
import java.util.concurrent.*;

// æ–¹å¼1ï¼šExecutors å·¥å‚æ–¹æ³•ï¼ˆä¸æ¨èï¼Œæœ‰OOMé£é™©ï¼‰
ExecutorService pool1 = Executors.newFixedThreadPool(10);
ExecutorService pool2 = Executors.newCachedThreadPool();
ExecutorService pool3 = Executors.newSingleThreadExecutor();

// æ–¹å¼2ï¼šThreadPoolExecutor æ‰‹åŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰
ThreadPoolExecutor executor = new ThreadPoolExecutor(
    5,                      // æ ¸å¿ƒçº¿ç¨‹æ•°
    10,                     // æœ€å¤§çº¿ç¨‹æ•°
    60L,                    // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´
    TimeUnit.SECONDS,       // æ—¶é—´å•ä½
    new LinkedBlockingQueue<>(100),  // ä»»åŠ¡é˜Ÿåˆ—
    Executors.defaultThreadFactory(), // çº¿ç¨‹å·¥å‚
    new ThreadPoolExecutor.CallerRunsPolicy()  // æ‹’ç»ç­–ç•¥
);
```

#### 3. çº¿ç¨‹æ± å‚æ•°è¯¦è§£

| å‚æ•° | è¯´æ˜ |
|------|------|
| corePoolSize | æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¿ç•™ |
| maximumPoolSize | æœ€å¤§çº¿ç¨‹æ•° |
| keepAliveTime | éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ |
| workQueue | ä»»åŠ¡ç­‰å¾…é˜Ÿåˆ— |
| threadFactory | åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ |
| handler | æ‹’ç»ç­–ç•¥ |

**æ‹’ç»ç­–ç•¥**ï¼š
- `AbortPolicy`ï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰
- `CallerRunsPolicy`ï¼šç”±è°ƒç”¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡
- `DiscardPolicy`ï¼šé™é»˜ä¸¢å¼ƒä»»åŠ¡
- `DiscardOldestPolicy`ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€è€çš„ä»»åŠ¡

#### 4. çº¿ç¨‹æ± ä½¿ç”¨

```java
// æäº¤ä»»åŠ¡
executor.execute(() -> System.out.println("ä»»åŠ¡1"));

// æäº¤æœ‰è¿”å›å€¼çš„ä»»åŠ¡
Future<Integer> future = executor.submit(() -> 42);
Integer result = future.get();

// æ‰¹é‡æäº¤
List<Callable<Integer>> tasks = Arrays.asList(
    () -> 1, () -> 2, () -> 3
);
List<Future<Integer>> futures = executor.invokeAll(tasks);

// å…³é—­çº¿ç¨‹æ± 
executor.shutdown();  // ä¼˜é›…å…³é—­ï¼Œç­‰å¾…ä»»åŠ¡å®Œæˆ
// executor.shutdownNow();  // ç«‹å³å…³é—­ï¼Œè¿”å›æœªæ‰§è¡Œä»»åŠ¡
```

---

### äº”ã€çº¿ç¨‹çŠ¶æ€

```
NEWï¼ˆæ–°å»ºï¼‰â†’ start() â†’ RUNNABLEï¼ˆå¯è¿è¡Œï¼‰â†’ wait() â†’ WAITINGï¼ˆç­‰å¾…ï¼‰
                              â†“                      â†“ notify()
                         sleep() â†’ TIMED_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰
                              â†“
                         è·å–é”å¤±è´¥ â†’ BLOCKEDï¼ˆé˜»å¡ï¼‰
                              â†“
                         run()ç»“æŸ â†’ TERMINATEDï¼ˆç»ˆæ­¢ï¼‰
```

**çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å›¾ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Java çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è¯¦è§£        â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚        NEWï¼ˆæ–°å»ºçŠ¶æ€ï¼‰                 â”‚           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â”‚   â€¢ åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œæœªè°ƒç”¨ start()              â”‚           â”‚
â”‚   â”‚   â€¢ Thread t = new Thread()               â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â”‚ è°ƒç”¨ start()                          â”‚
â”‚                      â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚     RUNNABLEï¼ˆå¯è¿è¡ŒçŠ¶æ€ï¼‰             â”‚           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â”‚   â€¢ è°ƒç”¨ start() åè¿›å…¥æ­¤çŠ¶æ€                â”‚           â”‚
â”‚   â”‚   â€¢ ç­‰å¾… CPU åˆ†é…æ—¶é—´ç‰‡                     â”‚           â”‚
â”‚   â”‚   â€¢ å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ç­‰å¾… CPU              â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â–¼                       â–¼                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   BLOCKED       â”‚   â”‚   WAITING       â”‚           â”‚
â”‚   â”‚   é˜»å¡çŠ¶æ€       â”‚   â”‚   ç­‰å¾…çŠ¶æ€       â”‚           â”‚
â”‚   â”‚                 â”‚   â”‚                 â”‚           â”‚
â”‚   â”‚   â€¢ ç­‰å¾…é”       â”‚   â”‚   è°ƒç”¨ wait()   â”‚           â”‚
â”‚   â”‚   â€¢ synchronized â”‚   â”‚   â€¢ è°ƒç”¨ join()  â”‚           â”‚
â”‚   â”‚     é˜»å¡         â”‚   â”‚   â€¢ è°ƒç”¨         â”‚           â”‚
â”‚   â”‚                 â”‚   â”‚   Lock.lock()    â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚            â”‚                      â”‚                       â”‚
â”‚            â”‚ è·å¾—é”               â”‚ notify()               â”‚
â”‚            â”‚                      â”‚ notifyAll()            â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   RUNNABLEï¼ˆé‡æ–°å¯è¿è¡Œï¼‰              â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â”‚ sleep(time)                          â”‚
â”‚                      â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  TIMED_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰            â”‚           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â”‚   â€¢ Thread.sleep(1000)                  â”‚           â”‚
â”‚   â”‚   â€¢ t.join(1000)                        â”‚           â”‚
â”‚   â”‚   â€¢ Lock.tryLock(1000)                 â”‚           â”‚
â”‚   â”‚   â€¢ è¶…æ—¶åè‡ªåŠ¨è¿”å› RUNNABLE            â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â”‚ è¶…æ—¶ / è¢«ä¸­æ–­                          â”‚
â”‚                      â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   RUNNABLEï¼ˆé‡æ–°å¯è¿è¡Œï¼‰              â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â”‚ run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•                     â”‚
â”‚                      â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   TERMINATEDï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰               â”‚           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â”‚   â€¢ çº¿ç¨‹æ‰§è¡Œå®Œæˆ                          â”‚           â”‚
â”‚   â”‚   â€¢ è°ƒç”¨ stop()ï¼ˆå·²åºŸå¼ƒï¼‰                   â”‚           â”‚
â”‚   â”‚   â€¢ æŠ›å‡ºæœªæ•è·å¼‚å¸¸                        â”‚           â”‚
â”‚   â”‚   â€¢ ä¸èƒ½å†å¯åŠ¨                              â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                             â”‚
â”‚   çŠ¶æ€è½¬æ¢æ€»ç»“ï¼š                                              â”‚
â”‚   â€¢ NEW â†’ RUNNABLEï¼šè°ƒç”¨ start()                          â”‚
â”‚   â€¢ RUNNABLE â†’ BLOCKEDï¼šç­‰å¾… synchronized é”               â”‚
â”‚   â€¢ RUNNABLE â†’ WAITINGï¼šè°ƒç”¨ wait()ã€join() ç­‰            â”‚
â”‚   â€¢ RUNNABLE â†’ TIMED_WAITINGï¼šè°ƒç”¨ sleep()ã€join(time) ç­‰   â”‚
â”‚   â€¢ BLOCKED/WAITING/TIMED_WAITING â†’ RUNNABLEï¼šè·å¾—é”/è¶…æ—¶/è¢«å”¤é†’â”‚
â”‚   â€¢ RUNNABLE â†’ TERMINATEDï¼šrun() æ–¹æ³•æ‰§è¡Œå®Œæ¯•                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é—®ç­”

### Q1ï¼šstart() å’Œ run() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”**ï¼š
- `start()`ï¼šå¯åŠ¨æ–°çº¿ç¨‹ï¼ŒJVM è°ƒç”¨ `run()` æ–¹æ³•ï¼Œå¼‚æ­¥æ‰§è¡Œã€‚
- `run()`ï¼šæ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚
- **æ³¨æ„**ï¼šç›´æ¥è°ƒç”¨ `run()` ä¸ä¼šå®ç°å¤šçº¿ç¨‹æ•ˆæœã€‚

### Q2ï¼šsynchronized å’Œ Lock å¦‚ä½•é€‰æ‹©ï¼Ÿ

**ç­”**ï¼š
- **synchronized**ï¼šç®€å•åœºæ™¯ï¼Œä»£ç ç®€æ´ï¼Œè‡ªåŠ¨é‡Šæ”¾é”ã€‚
- **Lock**ï¼šéœ€è¦é«˜çº§åŠŸèƒ½ï¼ˆå¯ä¸­æ–­ã€è¶…æ—¶ã€å¤šæ¡ä»¶ï¼‰ï¼Œæ‰‹åŠ¨æ§åˆ¶é”ã€‚
- **å»ºè®®**ï¼šä¼˜å…ˆä½¿ç”¨ synchronizedï¼Œä¸æ»¡è¶³éœ€æ±‚æ—¶å†ç”¨ Lockã€‚

### Q3ï¼šwait() å’Œ sleep() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”**ï¼š
| ç‰¹æ€§ | wait() | sleep() |
|------|--------|---------|
| æ‰€å±ç±» | Object | Thread |
| é”é‡Šæ”¾ | é‡Šæ”¾ | ä¸é‡Šæ”¾ |
| ä½¿ç”¨åœºæ™¯ | çº¿ç¨‹é€šä¿¡ | æš‚åœæ‰§è¡Œ |
| å”¤é†’æ–¹å¼ | notify()/notifyAll() | æ—¶é—´åˆ°è‡ªåŠ¨å”¤é†’ |
| è°ƒç”¨ä½ç½® | åŒæ­¥ä»£ç å—å†… | ä»»æ„ä½ç½® |

### Q4ï¼šçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ

**ç­”**ï¼š
- **CPU å¯†é›†å‹**ï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° + 1
- **IO å¯†é›†å‹**ï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° Ã— 2 æˆ–æ›´é«˜
- **æ··åˆå‹**ï¼šæ ¹æ®å®é™…æƒ…å†µæµ‹è¯•è°ƒæ•´
- **å…¬å¼**ï¼š`çº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° Ã— (1 + ç­‰å¾…æ—¶é—´ / è®¡ç®—æ—¶é—´)`

### Q5ï¼šä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ

**ç­”**ï¼š
- **æ­»é”**ï¼šå¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ°¸ä¹…é˜»å¡ã€‚
- **äº§ç”Ÿæ¡ä»¶**ï¼šäº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªç¯ç­‰å¾…ã€‚
- **é¿å…æ–¹æ³•**ï¼š
  - æŒ‰å›ºå®šé¡ºåºè·å–é”
  - ä½¿ç”¨è¶…æ—¶æœºåˆ¶ï¼ˆtryLockï¼‰
  - å‡å°‘é”çš„æŒæœ‰æ—¶é—´
  - ä½¿ç”¨å¹¶å‘å·¥å…·ç±»ï¼ˆConcurrentHashMap ç­‰ï¼‰

---

> **å­¦ä¹ å»ºè®®**ï¼šå¤šçº¿ç¨‹æ˜¯ Java é«˜çº§ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯é¢è¯•é‡ç‚¹ã€‚åŠ¡å¿…ç†è§£çº¿ç¨‹åŒæ­¥çš„åŸç†ï¼ŒæŒæ¡ synchronized å’Œ Lock çš„ä½¿ç”¨ï¼Œç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹æ± ã€‚å»ºè®®å¤šå†™ç»ƒä¹ ï¼Œç‰¹åˆ«æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…ç­‰ç»å…¸æ¨¡å‹ã€‚
