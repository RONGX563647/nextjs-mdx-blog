# 边缘计算网络架构

## 一、问题引入：集中式计算的瓶颈

### 1.1 真实案例：工业物联网延迟问题

```
场景：智能制造工厂，10000+传感器实时采集
问题：数据上传云端处理，延迟高达500ms，无法满足实时控制需求

边缘计算改造：
┌─────────────────────────────────────────────────────────────┐
│ 改造前（集中式）：                                           │
│ 传感器 → 网关 → 互联网 → 云端 → 处理 → 下发控制             │
│ 延迟：500ms                                                  │
├─────────────────────────────────────────────────────────────┤
│ 改造后（边缘计算）：                                         │
│ 传感器 → 边缘节点 → 本地处理 → 实时控制                     │
│ 延迟：10ms                                                   │
│                                                              │
│ 效果：                                                       │
│ - 延迟降低98%                                                │
│ - 带宽成本降低70%                                            │
│ - 断网可继续运行                                             │
└─────────────────────────────────────────────────────────────┘
```

## 二、边缘计算架构

### 2.1 三层架构

```
边缘计算三层架构：
┌──────────────────────────────────────────────────────────────┐
│ 云中心（Cloud）                                              │
│ - 大规模数据分析                                             │
│ - AI模型训练                                                 │
│ - 全局管理                                                   │
├──────────────────────────────────────────────────────────────┤
│ 边缘层（Edge）                                               │
│ - 边缘数据中心                                               │
│ - 5G MEC节点                                                 │
│ - CDN节点                                                    │
│ - 本地数据处理                                               │
├──────────────────────────────────────────────────────────────┤
│ 设备层（Device）                                             │
│ - IoT传感器                                                  │
│ - 智能终端                                                   │
│ - 工业设备                                                   │
└──────────────────────────────────────────────────────────────┘
```

### 2.2 边缘网络拓扑

```
边缘网络架构：
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐                 │
│  │  云中心  │◄──►│  骨干网  │◄──►│  边缘DC │                 │
│  └─────────┘    └─────────┘    └────┬────┘                 │
│                                      │                       │
│                         ┌────────────┼────────────┐         │
│                         ▼            ▼            ▼         │
│                      ┌─────┐     ┌─────┐     ┌─────┐       │
│                      │MEC-1│     │MEC-2│     │MEC-3│       │
│                      └──┬──┘     └──┬──┘     └──┬──┘       │
│                         │            │            │          │
│                      ┌──┴──┐     ┌──┴──┐     ┌──┴──┐       │
│                      │IoT-1│     │IoT-2│     │IoT-3│       │
│                      └─────┘     └─────┘     └─────┘       │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## 三、KubeEdge边缘计算平台

### 3.1 KubeEdge架构

```
KubeEdge架构：
┌──────────────────────────────────────────────────────────────┐
│ 云端（Cloud）                                                │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ CloudCore                                              │  │
│ │  - CloudHub：连接边缘节点                               │  │
│ │  - EdgeController：管理边缘应用                         │  │
│ │  - DeviceController：管理设备                           │  │  │
│ └────────────────────────────────────────────────────────┘  │
│                              │                               │
│                           公网/专线                          │
│                              │                               │
│ 边缘端（Edge）                ▼                               │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ EdgeCore                                               │  │
│ │  - Edged：边缘容器运行时                                │  │
│ │  - EventBus：MQTT消息总线                               │  │
│ │  - ServiceBus：服务发现                                 │  │
│ │  - DeviceTwin：设备影子                                 │  │
│ │  - MetaManager：元数据管理                              │  │
│ └────────────────────────────────────────────────────────┘  │
│                              │                               │
│                           MQTT                              │
│                              │                               │
│                        ┌─────┐                              │
│                        │IoT设备│                              │
│                        └─────┘                              │
└──────────────────────────────────────────────────────────────┘
```

### 3.2 KubeEdge部署

```yaml
# 边缘应用部署
apiVersion: apps/v1
kind: Deployment
metadata:
  name: edge-app
  labels:
    app: edge-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: edge-app
  template:
    metadata:
      labels:
        app: edge-app
    spec:
      nodeSelector:
        node-role.kubernetes.io/edge: "true"
      containers:
        - name: app
          image: edge-app:latest
          resources:
            limits:
              memory: "256Mi"
              cpu: "500m"
---
# 设备模型
apiVersion: devices.kubeedge.io/v1alpha2
kind: DeviceModel
metadata:
  name: temperature-model
spec:
  properties:
    - name: temperature
      description: Temperature in Celsius
      type:
        string:
          accessMode: ReadOnly
---
# 设备实例
apiVersion: devices.kubeedge.io/v1alpha2
kind: Device
metadata:
  name: sensor-001
spec:
  deviceModelRef:
    name: temperature-model
  nodeSelector:
    nodeSelectorTerms:
      - matchExpressions:
          - key: ""
            operator: In
            values:
              - edge-node-1
```

## 四、边缘网络优化

### 4.1 边缘缓存策略

```java
/**
 * 边缘缓存管理
 */
@Component
public class EdgeCacheManager {
    
    @Autowired
    private Cache edgeCache;
    
    /**
     * 本地缓存优先
     */
    public <T> T getWithEdgeCache(String key, Supplier<T> loader) {
        // 1. 查询本地缓存
        T value = edgeCache.getIfPresent(key);
        if (value != null) {
            return value;
        }
        
        // 2. 查询邻近边缘节点
        value = queryNeighborEdges(key);
        if (value != null) {
            edgeCache.put(key, value);
            return value;
        }
        
        // 3. 回源到云端
        value = loader.get();
        edgeCache.put(key, value);
        return value;
    }
    
    /**
     * 缓存同步策略
     */
    @Scheduled(fixedRate = 60000)
    public void syncWithCloud() {
        // 增量同步到云端
        List<CacheEntry> dirtyEntries = getDirtyEntries();
        cloudSyncClient.batchSync(dirtyEntries);
    }
}
```

### 4.2 边缘智能路由

```yaml
# Istio边缘路由
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: edge-routing
spec:
  hosts:
    - api.example.com
  http:
    - match:
        - headers:
            x-edge-location:
              exact: "beijing"
      route:
        - destination:
            host: edge-service-beijing
    - match:
        - headers:
            x-edge-location:
              exact: "shanghai"
      route:
        - destination:
            host: edge-service-shanghai
    - route:
        - destination:
            host: cloud-service
```

## 五、边缘安全

```
边缘安全挑战：
┌──────────────────────────────────────────────────────────────┐
│ 物理安全：                                                   │
│ - 边缘节点分布广泛，物理接触风险高                           │
│ - 解决方案：硬件安全模块（HSM）、可信执行环境（TEE）         │
├──────────────────────────────────────────────────────────────┤
│ 网络安全：                                                   │
│ - 边缘到云端通信安全                                         │
│ - 解决方案：mTLS、VPN、零信任架构                            │
├──────────────────────────────────────────────────────────────┤
│ 数据安全：                                                   │
│ - 敏感数据本地加密                                           │
│ - 解决方案：边缘数据脱敏、本地密钥管理                       │
└──────────────────────────────────────────────────────────────┘
```

---

**系列上一篇**：[QUIC协议原理与实践](13QUIC协议原理与实践.md)

**系列下一篇**：[网络可观测性建设](15网络可观测性建设.md)
