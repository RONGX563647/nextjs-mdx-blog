# AI博客助手悬浮球功能实现计划

## 技术方案

### 技术栈
- **框架**：React 18 + TypeScript
- **动画**：Framer Motion（项目已集成）
- **样式**：Tailwind CSS（项目已使用）
- **图标**：lucide-react（项目已使用）
- **状态管理**：React Hooks (useState, useEffect, useRef)

### 设计风格
- **配色**：使用项目现有的配色方案
  - 悬浮球：`bg-primary` (橙色/琥珀色)
  - 侧边栏：`bg-background` (白色)
  - 边框：`border-border` (灰色)
  - 文字：`text-foreground` (深灰色)
- **圆角**：`rounded` (0.25rem)
- **阴影**：`shadow-lg`

## 组件结构

### 1. 悬浮球组件 (`FloatingBall.tsx`)
**位置**：固定在右下角
**功能**：
- 显示AI助手图标（使用 lucide-react 的 Bot 或 MessageSquare）
- 悬停效果：放大、阴影增强
- 拖拽功能：支持拖拽到任意位置
- 点击事件：触发侧边栏展开

### 2. 侧边栏组件 (`AISidebar.tsx`)
**位置**：从右侧滑出
**宽度**：350-400px（响应式）
**子组件**：
- **标题栏**：显示"AI助手"或类似文字
- **关闭按钮**：点击收起侧边栏
- **消息区域**：滚动容器，显示对话历史
- **输入区域**：文本输入框 + 发送按钮

### 3. 对话消息组件 (`ChatMessage.tsx`)
**类型**：
- 用户消息（右侧对齐）
- AI消息（左侧对齐）
- 流式输出效果（逐字/逐句显示）
- 加载状态（打字动画或进度指示器）
- 错误提示

### 4. 输入区域组件 (`ChatInput.tsx`)
**功能**：
- 多行文本输入框
- 发送按钮（支持点击和 Enter 键）
- 禁用状态（加载时禁用）
- 字符计数

### 5. AI交互逻辑 (`useAIChat.ts`)
**功能**：
- 管理对话历史
- 流式输出处理
- API调用模拟（使用 setTimeout 模拟AI响应）
- 错误处理
- 加载状态管理

### 6. 对话历史记录 (`useChatHistory.ts`)
**功能**：
- localStorage 存储
- 刷新后恢复
- 清除历史记录

## 实现步骤

### 阶段1：创建基础组件
1. 创建 `FloatingBall.tsx` - 悬浮球组件
2. 创建 `AISidebar.tsx` - 侧边栏主组件
3. 创建 `ChatMessage.tsx` - 对话消息组件
4. 创建 `ChatInput.tsx` - 输入区域组件

### 阶段2：创建自定义 Hooks
1. 创建 `useAIChat.ts` - AI交互逻辑
2. 创建 `useChatHistory.ts` - 对话历史管理
3. 创建 `useDraggable.ts` - 拖拽功能

### 阶段3：集成到布局
1. 在 `layout.tsx` 中添加 `FloatingBall` 和 `AISidebar`
2. 确保不影响现有页面功能

### 阶段4：响应式优化
1. 移动端适配（侧边栏全屏显示）
2. 悬浮球在移动端适当缩小
3. 触摸事件支持

### 阶段5：性能优化
1. 使用 React.memo 优化组件渲染
2. 使用 useMemo 缓存计算结果
3. 使用 useCallback 优化事件处理函数
4. 虚拟滚动优化长对话历史

## 文件结构

```
src/components/ai/
├── FloatingBall.tsx          # 悬浮球组件
├── AISidebar.tsx            # 侧边栏主组件
├── ChatMessage.tsx           # 对话消息组件
└── ChatInput.tsx             # 输入区域组件

src/hooks/ai/
├── useAIChat.ts             # AI交互逻辑
├── useChatHistory.ts         # 对话历史管理
└── useDraggable.ts           # 拖拽功能
```

## 关键特性

### 流式输出
- 使用打字机效果逐字显示
- 支持Markdown渲染
- 自动滚动到底部

### 拖拽功能
- 支持鼠标拖拽悬浮球
- 限制拖拽范围（防止拖出屏幕）
- 记住拖拽位置（localStorage）

### 对话历史
- 自动保存到 localStorage
- 页面刷新后恢复
- 支持清除历史

### 响应式设计
- 桌面端：侧边栏宽度 400px
- 移动端：侧边栏全屏宽度 100%
- 悬浮球：桌面端 60px，移动端 48px

### 错误处理
- 网络错误提示
- API超时处理
- 友好的错误消息显示